<!doctype html>
<html lang="ru">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,height=device-height,initial-scale=1.0">
<title>–†–µ–¥–∞–∫—Ç–æ—Ä ¬´–ù–∞–π–¥–∏ –ø–µ—Ä—Å–æ–Ω–∞–∂–∞¬ª</title>

<style>
*{box-sizing:border-box}
html,body{margin:0;height:100%;font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial;background:#0b1020;color:#fff}
.wrap{display:grid;grid-template-columns:360px 1fr;height:100%}

/* –ø–∞–Ω–µ–ª—å */
.panel{
  background:rgba(20,24,40,.85);
  border-right:1px solid rgba(255,255,255,.15);
  padding:14px;
  overflow:auto;
}
.panel h1{font-size:16px;margin:0 0 12px}
label{font-size:12px;opacity:.7}
input,textarea{
  width:100%;
  padding:10px;
  margin:6px 0 12px;
  border-radius:10px;
  border:1px solid rgba(255,255,255,.2);
  background:rgba(255,255,255,.06);
  color:#fff;
}
textarea{min-height:70px;resize:vertical}
button{
  padding:10px 12px;
  border-radius:10px;
  border:0;
  cursor:pointer;
  font-weight:700;
}
.btn-blue{background:#2563eb;color:#fff}
.btn-green{background:#16a34a;color:#fff}
.btn-ghost{background:rgba(255,255,255,.1);color:#fff}
.btns{display:flex;gap:8px;flex-wrap:wrap}
.code{height:220px;font-family:ui-monospace,monospace;font-size:12px}

/* —Å—Ü–µ–Ω–∞ */
.stage{
  position:relative;
  background:
    linear-gradient(0deg,rgba(255,255,255,.04),rgba(255,255,255,.04)),
    repeating-linear-gradient(45deg,rgba(255,255,255,.035) 0 12px,rgba(255,255,255,.02) 12px 24px);
  overflow:hidden;
}

/* UI */
.task{
  position:absolute;
  top:16px;left:50%;
  transform:translateX(-50%);
  background:rgba(0,0,0,.45);
  border:1px solid rgba(255,255,255,.2);
  border-radius:14px;
  padding:10px 14px;
  font-weight:700;
  z-index:10;
}
.progress{
  position:absolute;
  right:14px;top:14px;
  background:rgba(0,0,0,.45);
  border:1px solid rgba(255,255,255,.2);
  border-radius:999px;
  padding:6px 10px;
  font-size:12px;
  z-index:10;
}
.hint{
  position:absolute;
  right:64px;top:12px;
  width:38px;height:38px;
  border-radius:12px;
  background:rgba(0,0,0,.35);
  border:1px solid rgba(255,255,255,.2);
  cursor:pointer;
  font-size:18px;
  z-index:10;
}

/* –ø–µ—Ä—Å–æ–Ω–∞–∂ */
.target{
  position:absolute;
  cursor:pointer;
  z-index:20;
}
.target img{
  width:100%;
  height:100%;
  object-fit:contain;
}

/* —ç—Ñ—Ñ–µ–∫—Ç—ã */
@keyframes fade{
  from{opacity:0;transform:scale(.96)}
  to{opacity:1;transform:scale(1)}
}
.fade{animation:fade var(--dur,900ms) ease-out}

@keyframes pulse{
  0%{transform:scale(1)}
  50%{transform:scale(1.3)}
  100%{transform:scale(1)}
}
.hintFx img{animation:pulse .8s ease-in-out 2}
</style>
</head>

<body>
<div class="wrap">
  <div class="panel">
    <h1>–†–µ–¥–∞–∫—Ç–æ—Ä ¬´–ù–∞–π–¥–∏ –ø–µ—Ä—Å–æ–Ω–∞–∂–∞¬ª</h1>

    <label>URL –∫–∞—Ä—Ç–∏–Ω–∫–∏ –ø–µ—Ä—Å–æ–Ω–∞–∂–∞</label>
    <input id="url">

    <label>–†–∞–∑–º–µ—Ä (px)</label>
    <input id="size" type="range" min="20" max="220" value="46">

    <label>–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –Ω–∞—Ö–æ–¥–æ–∫</label>
    <input id="rounds" type="number" value="7">

    <label>–ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è</label>
    <input id="taskText">

    <label>–¢–µ–∫—Å—Ç –≤ –∫–æ–Ω—Ü–µ</label>
    <textarea id="endText"></textarea>

    <div class="btns">
      <button class="btn-ghost" id="reset">–°–±—Ä–æ—Å</button>
      <button class="btn-blue" id="get">–ü–æ–ª—É—á–∏—Ç—å –∫–æ–¥</button>
      <button class="btn-green" id="copy">–ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å –∫–æ–¥</button>
    </div>

    <textarea id="code" class="code"></textarea>
  </div>

  <div class="stage" id="stage">
    <div class="task" id="task"></div>
    <div class="progress" id="prog">0/0</div>
    <button class="hint" id="hint">üí°</button>

    <div class="target fade" id="target">
      <img id="img">
    </div>
  </div>
</div>

<script>
/* === –í–ê–ñ–ù–û: —Ñ–∞–π–ª –ë–ï–ó .png === */
const DEFAULT_URL =
  "https://propodgotovkaa-creator.github.io/babochka_2/babushka_2?img=1";

const $=id=>document.getElementById(id);

const stage=$("stage"),
      target=$("target"),
      img=$("img"),
      url=$("url"),
      size=$("size"),
      rounds=$("rounds"),
      taskText=$("taskText"),
      endText=$("endText"),
      task=$("task"),
      prog=$("prog"),
      hint=$("hint"),
      code=$("code");

let found=0, lastPos=null;

function rect(){
  const r=stage.getBoundingClientRect();
  return {w:r.width,h:r.height};
}

function place(){
  const {w,h}=rect();
  const s=target.offsetWidth;
  let tries=0, x,y;
  do{
    x=Math.random()*(w-s);
    y=Math.random()*(h-s);
    tries++;
  }while(lastPos && Math.hypot(x-lastPos.x,y-lastPos.y)<w*0.25 && tries<40);

  lastPos={x,y};
  target.style.left=x+"px";
  target.style.top=y+"px";
}

function next(){
  if(found>=+rounds.value){
    task.textContent=endText.value;
    target.style.display="none";
    return;
  }
  prog.textContent=`${found}/${rounds.value}`;
  place();
}

target.onclick=()=>{
  found++;
  next();
};

hint.onclick=()=>{
  target.classList.remove("hintFx");
  void target.offsetWidth;
  target.classList.add("hintFx");
};

size.oninput=()=>{
  target.style.width=target.style.height=size.value+"px";
  place();
};

$("reset").onclick=()=>{
  found=0;
  img.src=url.value;
  target.style.display="block";
  next();
};

$("get").onclick=()=>{
  code.value =
`<iframe
src="https://propodgotovkaa-creator.github.io/babochka_2/"
style="border:0;width:100%;height:100%;background:transparent;"
allow="clipboard-write"></iframe>`;
};

$("copy").onclick=()=>navigator.clipboard.writeText(code.value);

/* init */
url.value=DEFAULT_URL;
img.src=DEFAULT_URL;
taskText.value="–ù–∞–π–¥–∏ –±–∞–±–æ—á–∫—É –∏ –Ω–∞–∂–º–∏ –Ω–∞ –Ω–µ—ë!";
endText.value="–ú–æ–ª–æ–¥–µ—Ü! –ü—Ä–∏—Ö–æ–¥–∏ –∏–≥—Ä–∞—Ç—å –µ—â—ë —Ä–∞–∑ üòä";
target.style.width=target.style.height=size.value+"px";
task.textContent=taskText.value;
prog.textContent=`0/${rounds.value}`;
place();
</script>
</body>
</html>
