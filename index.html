<!doctype html>
<html lang="ru">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,height=device-height,initial-scale=1.0"/>
<title>–†–µ–¥–∞–∫—Ç–æ—Ä ¬´–ù–∞–π–¥–∏ –ø–µ—Ä—Å–æ–Ω–∞–∂–∞¬ª</title>
<style>
  :root{
    --bg1:#0d1220; --bg2:#0a0f1b;
    --panel: rgba(14,18,34,.80);
    --stroke: rgba(255,255,255,.12);
    --text: rgba(255,255,255,.92);
    --muted: rgba(255,255,255,.70);
    --shadow: 0 22px 70px rgba(0,0,0,.35);
    --radius: 18px;
    --blue:#2d6cff; --green:#22c55e; --gray:rgba(255,255,255,.10);
  }
  html,body{height:100%;margin:0;font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial;background:transparent}
  body{
    background:
      radial-gradient(900px 600px at 20% 15%, rgba(70,110,255,.22), transparent 60%),
      radial-gradient(900px 600px at 85% 35%, rgba(130,255,220,.13), transparent 58%),
      linear-gradient(180deg, var(--bg1), var(--bg2));
    color:var(--text); overflow:hidden;
  }
  .app{position:fixed;inset:0;display:grid;grid-template-columns:360px 1fr;gap:14px;padding:14px;box-sizing:border-box}
  .panel{
    background:var(--panel); border:1px solid var(--stroke); border-radius:var(--radius);
    box-shadow:var(--shadow); backdrop-filter:blur(10px);
    padding:14px; overflow:auto;
  }
  .stageWrap{
    position:relative; border-radius:var(--radius); overflow:hidden;
    border:1px solid var(--stroke); box-shadow:var(--shadow);
    background:
      repeating-linear-gradient(135deg, rgba(255,255,255,.04) 0, rgba(255,255,255,.04) 8px, rgba(255,255,255,.02) 8px, rgba(255,255,255,.02) 16px);
  }
  h1{font-size:18px;margin:0 0 8px 0}
  .hint{font-size:12px;line-height:1.35;color:var(--muted);margin:0 0 12px 0}
  .field{margin:10px 0}
  label{display:block;font-size:12px;color:var(--muted);margin:0 0 6px 0}
  input[type="text"], input[type="number"], textarea, select{
    width:100%; box-sizing:border-box;
    padding:10px 10px;
    border-radius:12px;
    border:1px solid var(--stroke);
    background:rgba(0,0,0,.25);
    color:var(--text);
    outline:none;
  }
  textarea{min-height:72px;resize:vertical}
  .row{display:grid;grid-template-columns:1fr 1fr;gap:10px}
  .sliderRow{display:grid;grid-template-columns:1fr auto;gap:10px;align-items:center}
  input[type="range"]{width:100%}
  .pill{
    font-size:12px; color:var(--text);
    padding:6px 10px; border-radius:999px;
    border:1px solid var(--stroke);
    background:rgba(0,0,0,.25);
    min-width:70px; text-align:center;
  }
  .btnRow{display:flex;gap:10px;margin-top:12px;flex-wrap:wrap}
  button{
    border:0; border-radius:12px; padding:10px 12px;
    color:var(--text); cursor:pointer; font-weight:800;
    background:var(--gray);
  }
  .btnBlue{background:var(--blue)}
  .btnGreen{background:var(--green)}
  button:active{transform:translateY(1px)}
  .note{font-size:12px;color:var(--muted);margin-top:8px}
  .codeBox{
    width:100%; min-height:240px; margin-top:10px;
    font-family:ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", monospace;
    font-size:12px; line-height:1.35;
  }
  .toast{
    position:fixed; left:50%; bottom:18px; transform:translateX(-50%);
    background:rgba(0,0,0,.65);
    border:1px solid rgba(255,255,255,.14);
    padding:10px 14px; border-radius:999px;
    color:rgba(255,255,255,.94); font-size:13px;
    backdrop-filter:blur(10px);
    box-shadow:0 18px 50px rgba(0,0,0,.35);
    opacity:0; pointer-events:none; transition:opacity .2s ease;
    z-index:9999999;
  }
  .toast.show{opacity:1}
  .topRight{
    position:absolute; right:12px; top:12px; z-index:10;
    background:rgba(0,0,0,.35); border:1px solid rgba(255,255,255,.12);
    border-radius:12px; padding:8px 10px; font-size:12px; color:rgba(255,255,255,.8);
    backdrop-filter: blur(8px);
  }
</style>
</head>
<body>

<div class="app">
  <div class="panel">
    <h1>–†–µ–¥–∞–∫—Ç–æ—Ä ¬´–ù–∞–π–¥–∏ –ø–µ—Ä—Å–æ–Ω–∞–∂–∞¬ª</h1>
    <p class="hint">
      –≠—Ç–æ <b>—Ä–µ–¥–∞–∫—Ç–æ—Ä</b> (–ø–∞–Ω–µ–ª—å —Å–ª–µ–≤–∞) + <b>–ø—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä</b> (—Å–ø—Ä–∞–≤–∞).<br>
      –ù–∞–∂–º–∏ ¬´–ü–æ–ª—É—á–∏—Ç—å –∫–æ–¥¬ª ‚Üí –≤—Å—Ç–∞–≤—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç –≤ Genially (HTML/Embed).
    </p>

    <div class="field">
      <label>URL –∫–∞—Ä—Ç–∏–Ω–∫–∏ –ø–µ—Ä—Å–æ–Ω–∞–∂–∞ (–º–æ–∂–Ω–æ –æ—Å—Ç–∞–≤–∏—Ç—å –ø—É—Å—Ç—ã–º)</label>
      <input id="imgUrl" type="text" placeholder="https://.../image.png"/>
      <div class="note">–ï—Å–ª–∏ –ø—É—Å—Ç–æ ‚Äî –≤–æ–∑—å–º—ë–º —Ñ–∞–π–ª <b>babushka_2.png</b> —Ä—è–¥–æ–º —Å index.html</div>
    </div>

    <div class="row">
      <div class="field">
        <label>–†–∞–∑–º–µ—Ä (px)</label>
        <div class="sliderRow">
          <input id="size" type="range" min="24" max="180" value="46"/>
          <div class="pill"><span id="sizeVal">46</span> px</div>
        </div>
      </div>
      <div class="field">
        <label>–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –Ω–∞—Ö–æ–¥–æ–∫ (—Ä–∞—É–Ω–¥–æ–≤)</label>
        <input id="rounds" type="number" min="1" max="50" value="7"/>
      </div>
    </div>

    <div class="row">
      <div class="field">
        <label>–û—Ç—Å—Ç—É–ø –æ—Ç –∫—Ä–∞—ë–≤ (px)</label>
        <input id="pad" type="number" min="0" max="240" value="12"/>
      </div>
      <div class="field">
        <label>–ü–∞—É–∑–∞ –º–µ–∂–¥—É —Ä–∞—É–Ω–¥–∞–º–∏ (–º—Å)</label>
        <input id="gap" type="number" min="0" max="5000" value="200"/>
      </div>
    </div>

    <div class="row">
      <div class="field">
        <label>–ê–Ω–∏–º–∞—Ü–∏—è –ø–æ—è–≤–ª–µ–Ω–∏—è</label>
        <select id="anim">
          <option value="none">–±–µ–∑ –∞–Ω–∏–º–∞—Ü–∏–∏</option>
          <option value="softfade" selected>soft fade (–º–µ–¥–ª–µ–Ω–Ω–æ)</option>
          <option value="fade">fade</option>
          <option value="pop">pop</option>
          <option value="slide">slide</option>
          <option value="wiggle">wiggle</option>
        </select>
      </div>
      <div class="field">
        <label>–î–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –∞–Ω–∏–º–∞—Ü–∏–∏ (–º—Å)</label>
        <input id="dur" type="number" min="0" max="5000" value="1100"/>
      </div>
    </div>

    <div class="field">
      <label>–ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è (–ø–ª–∞—à–∫–∞ —Å–≤–µ—Ä—Ö—É –ø–æ —Ü–µ–Ω—Ç—Ä—É)</label>
      <input id="task" type="text" value="–ù–∞–π–¥–∏ –±–∞–±–æ—á–∫—É –∏ –Ω–∞–∂–º–∏ –Ω–∞ –Ω–µ—ë!"/>
    </div>

    <div class="field">
      <label>–¢–µ–∫—Å—Ç –≤ –∫–æ–Ω—Ü–µ –∏–≥—Ä—ã</label>
      <textarea id="endText">–ú–æ–ª–æ–¥–µ—Ü! –ü—Ä–∏—Ö–æ–¥–∏ –∏–≥—Ä–∞—Ç—å –µ—â—ë —Ä–∞–∑ üòä</textarea>
    </div>

    <div class="btnRow">
      <button class="btnBlue" id="btnCode">–ü–æ–ª—É—á–∏—Ç—å –∫–æ–¥</button>
      <button class="btnGreen" id="btnCopy">–ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å –∫–æ–¥</button>
      <button id="btnReset">–°–±—Ä–æ—Å</button>
    </div>

    <div class="field">
      <label>HTML-–∫–æ–¥ –¥–ª—è Genially (DIV + STYLE + SCRIPT)</label>
      <textarea class="codeBox" id="out" placeholder="–ù–∞–∂–º–∏ ¬´–ü–æ–ª—É—á–∏—Ç—å –∫–æ–¥¬ª"></textarea>
      <div class="note">
        –í Genially –≤—Å—Ç–∞–≤–ª—è–π –∏–º–µ–Ω–Ω–æ —ç—Ç–æ—Ç –∫–æ–¥ (–Ω–µ —Å—Å—ã–ª–∫—É –Ω–∞ —Ä–µ–¥–∞–∫—Ç–æ—Ä).
      </div>
    </div>
  </div>

  <div class="stageWrap">
    <div class="topRight">–ü—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä</div>
    <div id="PREVIEW_ROOT" style="position:absolute; inset:0;"></div>
  </div>
</div>

<div class="toast" id="toast">–°–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–æ ‚úÖ</div>

<script>
(function(){
  const $ = (id)=>document.getElementById(id);
  const ui = {
    imgUrl: $('imgUrl'),
    size: $('size'),
    sizeVal: $('sizeVal'),
    rounds: $('rounds'),
    pad: $('pad'),
    gap: $('gap'),
    anim: $('anim'),
    dur: $('dur'),
    task: $('task'),
    endText: $('endText'),
    out: $('out'),
    btnCode: $('btnCode'),
    btnCopy: $('btnCopy'),
    btnReset: $('btnReset'),
    toast: $('toast'),
    preview: $('PREVIEW_ROOT'),
  };

  // ‚úÖ –¥–µ—Ñ–æ–ª—Ç: –ª–æ–∫–∞–ª—å–Ω–∞—è –∫–∞—Ä—Ç–∏–Ω–∫–∞ (—Ä—è–¥–æ–º —Å index.html)
  const defaultLocal = new URL('./babushka_2.png', location.href).href;

  function toast(msg){
    ui.toast.textContent = msg;
    ui.toast.classList.add('show');
    setTimeout(()=>ui.toast.classList.remove('show'), 1100);
  }

  function cfg(){
    return {
      url: (ui.imgUrl.value || '').trim() || defaultLocal,
      size: parseInt(ui.size.value,10)||46,
      rounds: Math.max(1, parseInt(ui.rounds.value,10)||7),
      pad: Math.max(0, parseInt(ui.pad.value,10)||12),
      gap: Math.max(0, parseInt(ui.gap.value,10)||200),
      anim: ui.anim.value || 'softfade',
      dur: Math.max(0, parseInt(ui.dur.value,10)||1100),
      task: (ui.task.value||'').trim() || '–ù–∞–π–¥–∏ –ø–µ—Ä—Å–æ–Ω–∞–∂–∞!',
      endText: (ui.endText.value||'').trim() || '–ú–æ–ª–æ–¥–µ—Ü!'
    };
  }

  // —ç–∫—Ä–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–ª—è template string
  function safeTpl(s){
    return String(s)
      .replace(/\\/g,'\\\\')
      .replace(/`/g,'\\`')
      .replace(/\$\{/g,'\\${');
  }

  function buildWidgetCode(c){
    // –≠—Ç–æ —Ç–æ, —á—Ç–æ —Ç—ã –≤—Å—Ç–∞–≤–ª—è–µ—à—å –≤ Genially
    return `<div id="FX_ROOT">
  <style>
    #FX_ROOT{position:relative;width:100%;height:100%;min-width:100%;min-height:100%;overflow:hidden;background:transparent}
    #FX_ROOT,#FX_ROOT *{box-sizing:border-box}

    #FX_ROOT .fx_prog{
      position:absolute; right:14px; top:14px; z-index:999999;
      background:rgba(0,0,0,.45); border:1px solid rgba(255,255,255,.18);
      padding:6px 10px; border-radius:999px; font-size:12px; color:rgba(255,255,255,.9);
      backdrop-filter: blur(6px);
      pointer-events:none; user-select:none;
    }
    #FX_ROOT .fx_hintBtn{
      position:absolute; right:64px; top:12px;
      z-index:1000000;
      width:38px; height:38px;
      border-radius:12px;
      border:1px solid rgba(255,255,255,.18);
      background:rgba(0,0,0,.35);
      color:rgba(255,255,255,.92);
      font-size:18px;
      cursor:pointer;
      display:flex; align-items:center; justify-content:center;
      backdrop-filter: blur(6px);
      box-shadow: 0 12px 30px rgba(0,0,0,.18);
      -webkit-tap-highlight-color: transparent;
      user-select:none;
    }
    #FX_ROOT .fx_task{
      position:absolute; left:50%; top:18px; transform:translateX(-50%);
      z-index:999998;
      max-width:min(720px, calc(100% - 40px));
      background:rgba(0,0,0,.42);
      border:1px solid rgba(255,255,255,.18);
      border-radius:14px;
      padding:10px 14px;
      color:rgba(255,255,255,.95);
      font:700 14px/1.25 system-ui,-apple-system,Segoe UI,Roboto,Arial;
      text-align:center;
      backdrop-filter: blur(8px);
      pointer-events:none;
      user-select:none;
      box-shadow: 0 12px 30px rgba(0,0,0,.22);
    }

    #FX_ROOT .fx_target{ position:absolute; z-index:999999; cursor:pointer; user-select:none; -webkit-tap-highlight-color: transparent; }
    #FX_ROOT .fx_target img{display:block;width:100%;height:100%;object-fit:contain}

    @keyframes fxFadeIn{from{opacity:0}to{opacity:1}}
    @keyframes fxPopIn{0%{opacity:0;transform:scale(.7)}100%{opacity:1;transform:scale(1)}}
    @keyframes fxSlideIn{0%{opacity:0;transform:translateY(-10px)}100%{opacity:1;transform:translateY(0)}}
    @keyframes fxWiggle{0%{opacity:0;transform:scale(.9) rotate(-4deg)}70%{opacity:1;transform:scale(1.02) rotate(2deg)}100%{opacity:1;transform:scale(1) rotate(0deg)}}
    @keyframes fxSoftFade{0%{opacity:0;transform:scale(.96)}100%{opacity:1;transform:scale(1)}}

    #FX_ROOT .fx-fade{animation: fxFadeIn var(--dur,500ms) ease-out}
    #FX_ROOT .fx-pop{animation: fxPopIn var(--dur,500ms) cubic-bezier(.2,.8,.2,1)}
    #FX_ROOT .fx-slide{animation: fxSlideIn var(--dur,500ms) ease-out}
    #FX_ROOT .fx-wiggle{animation: fxWiggle var(--dur,650ms) cubic-bezier(.2,.8,.2,1)}
    #FX_ROOT .fx-softfade{animation: fxSoftFade var(--dur,1100ms) ease-out}

    @keyframes fxHintPulse{
      0%{transform:scale(1);opacity:1;filter:drop-shadow(0 0 0 rgba(120,220,255,0))}
      20%{transform:scale(1.25);opacity:1;filter:drop-shadow(0 0 14px rgba(120,220,255,.95))}
      40%{transform:scale(1);opacity:.35;filter:drop-shadow(0 0 0 rgba(120,220,255,0))}
      60%{transform:scale(1.25);opacity:1;filter:drop-shadow(0 0 16px rgba(120,220,255,.98))}
      80%{transform:scale(1);opacity:.35;filter:drop-shadow(0 0 0 rgba(120,220,255,0))}
      100%{transform:scale(1);opacity:1;filter:drop-shadow(0 0 0 rgba(120,220,255,0))}
    }
    #FX_ROOT .fx_target.fx-hint img{animation: fxHintPulse 900ms ease-in-out 0s 2}
  </style>

  <div class="fx_prog"></div>
  <button class="fx_hintBtn" type="button" aria-label="–ü–æ–¥—Å–∫–∞–∑–∫–∞" title="–ü–æ–¥—Å–∫–∞–∑–∫–∞">üí°</button>
  <div class="fx_task"></div>
  <div class="fx_target"><img alt=""></div>

  <script>
  (function(){
    const root = document.getElementById('FX_ROOT');
    const progEl = root.querySelector('.fx_prog');
    const hintBtn = root.querySelector('.fx_hintBtn');
    const taskEl = root.querySelector('.fx_task');
    const target = root.querySelector('.fx_target');
    const img = target.querySelector('img');

    const cfg = {
      url: \`${safeTpl(c.url)}\`,
      size: ${c.size|0},
      rounds: ${c.rounds|0},
      pad: ${c.pad|0},
      gap: ${c.gap|0},
      anim: \`${safeTpl(c.anim)}\`,
      dur: ${c.dur|0},
      task: \`${safeTpl(c.task)}\`,
      endText: \`${safeTpl(c.endText)}\`
    };

    let found = 0;
    let last = {x:null,y:null};
    const history = [];
    const HISTORY_MAX = 14;

    function clamp(n,a,b){ return Math.max(a, Math.min(b,n)); }
    function rect(){
      const r = root.getBoundingClientRect();
      return {w:Math.max(1,r.width), h:Math.max(1,r.height)};
    }
    function intersects(a,b){
      return !(a.x+a.w<=b.x || b.x+b.w<=a.x || a.y+a.h<=b.y || b.y+b.h<=a.y);
    }
    function toRootRect(el){
      const sr = root.getBoundingClientRect();
      const r = el.getBoundingClientRect();
      return { x:r.left - sr.left, y:r.top - sr.top, w:r.width, h:r.height };
    }
    function pushHistory(pt){ history.push({x:pt.x,y:pt.y}); if(history.length>HISTORY_MAX) history.shift(); }
    function distanceToHistory(pt){
      if(!history.length) return Infinity;
      let m=Infinity;
      for(const p of history) m=Math.min(m, Math.hypot(pt.x-p.x, pt.y-p.y));
      return m;
    }

    function getForbiddenRects(){
      const rects = [];
      const padUI = 10;

      for(const el of [taskEl, progEl, hintBtn]){
        const r = toRootRect(el);
        rects.push({ x:r.x-padUI, y:r.y-padUI, w:r.w+padUI*2, h:r.h+padUI*2 });
      }

      const {w,h} = rect();

      // –ª–æ–≥–æ—Ç–∏–ø Genially (—Å–ª–µ–≤–∞ —Å–Ω–∏–∑—É)
      rects.push({ x:0, y:h-78, w:200, h:78 });

      // –ø—è—Ç–Ω–æ —Å—Ç—Ä–µ–ª–∫–∏ —Å–ø—Ä–∞–≤–∞ –ø–æ —Ü–µ–Ω—Ç—Ä—É
      rects.push({ x:w-90, y:(h-160)/2, w:90, h:160 });

      return rects;
    }

    function setAnim(){
      target.classList.remove('fx-fade','fx-pop','fx-slide','fx-wiggle','fx-softfade');
      if(cfg.anim && cfg.anim !== 'none') target.classList.add('fx-' + cfg.anim);
      target.style.setProperty('--dur', Math.max(0, cfg.dur|0) + 'ms');
    }

    function updateUI(){
      progEl.textContent = found + '/' + Math.max(1, cfg.rounds|0);
      taskEl.textContent = (cfg.task||'–ù–∞–π–¥–∏ –ø–µ—Ä—Å–æ–Ω–∞–∂–∞!').trim();
      target.style.width = Math.max(1,cfg.size|0) + 'px';
      target.style.height = Math.max(1,cfg.size|0) + 'px';
    }

    function randomPos(){
      const {w,h} = rect();
      const s = Math.max(1, cfg.size|0);
      const p = clamp(cfg.pad|0, 0, 240);
      if(w < s + p*2 + 10 || h < s + p*2 + 10) return {x:p,y:p};

      const forbid = getForbiddenRects();
      const candidateRect = (pt)=>({x:pt.x,y:pt.y,w:s,h:s});

      // —Å–µ—Ç–∫–∞ 4x3 ‚Üí —Ö–æ–¥–∏–º –ø–æ —Ä–∞–∑–Ω—ã–º –∑–æ–Ω–∞–º, –≤–∫–ª—é—á–∞—è –Ω–∏–∑/—É–≥–ª—ã
      const cols=4, rows=3;
      const cellW=w/cols, cellH=h/rows;

      const cellUse = new Array(cols*rows).fill(0);
      for(const pt of history){
        const cx = Math.min(cols-1, Math.max(0, Math.floor(pt.x/cellW)));
        const cy = Math.min(rows-1, Math.max(0, Math.floor(pt.y/cellH)));
        cellUse[cy*cols+cx]++;
      }
      const order=[...cellUse.keys()].sort((a,b)=>cellUse[a]-cellUse[b]);

      function tryInCell(idx, tries){
        const cx=idx%cols, cy=Math.floor(idx/cols);
        const minX=Math.max(p, cx*cellW+p);
        const maxX=Math.min(w-p-s, (cx+1)*cellW-p-s);
        const minY=Math.max(p, cy*cellH+p);
        const maxY=Math.min(h-p-s, (cy+1)*cellH-p-s);
        if(maxX<=minX || maxY<=minY) return null;

        let best=null, bestScore=-1;
        for(let i=0;i<tries;i++){
          const pt={x:minX+Math.random()*(maxX-minX), y:minY+Math.random()*(maxY-minY)};
          const cr=candidateRect(pt);
          if(forbid.some(fr=>intersects(cr,fr))) continue;

          const dHist=distanceToHistory(pt);
          const dLast=(last.x===null)?dHist:Math.hypot(pt.x-last.x, pt.y-last.y);
          const score=dHist*1.05 + dLast*0.35 + Math.random()*12;
          if(score>bestScore){bestScore=score; best=pt;}
        }
        return best;
      }

      let best=null;
      for(const idx of order){
        best = tryInCell(idx, 55);
        if(best) break;
      }

      if(!best){
        const minX=p, minY=p, maxX=w-p-s, maxY=h-p-s;
        for(let k=0;k<220;k++){
          const pt={x:minX+Math.random()*(maxX-minX), y:minY+Math.random()*(maxY-minY)};
          const cr=candidateRect(pt);
          if(!forbid.some(fr=>intersects(cr,fr))){ best=pt; break; }
        }
        if(!best) best={x:minX,y:minY};
      }

      last=best; pushHistory(best);
      return best;
    }

    function place(){
      const pos = randomPos();
      target.style.left = pos.x + 'px';
      target.style.top  = pos.y + 'px';
    }

    function next(){
      updateUI();
      setAnim();
      place();
      target.style.display = '';
    }

    function hint(){
      target.classList.remove('fx-hint');
      void target.offsetWidth;
      target.classList.add('fx-hint');
      setTimeout(()=>target.classList.remove('fx-hint'), 1800);
    }

    hintBtn.addEventListener('click', hint);

    target.addEventListener('click', ()=>{
      found++;
      if(found >= Math.max(1, cfg.rounds|0)){
        taskEl.textContent = (cfg.endText||'–ú–æ–ª–æ–¥–µ—Ü!').trim();
        progEl.textContent = found + '/' + Math.max(1, cfg.rounds|0);
        target.style.display = 'none';
        return;
      }
      updateUI();
      target.style.display='none';
      setTimeout(next, Math.max(0, cfg.gap|0));
    });

    const ro = ('ResizeObserver' in window) ? new ResizeObserver(()=>{ if(target.style.display!=='none') place(); }) : null;
    if(ro) ro.observe(root);
    window.addEventListener('resize', ()=>{ if(target.style.display!=='none') place(); }, {passive:true});

    img.referrerPolicy = 'no-referrer';
    img.src = cfg.url;

    updateUI();
    next();
    // —Å—Ç—Ä–∞—Ö–æ–≤–∫–∞ –¥–ª—è Genially (–∏–Ω–æ–≥–¥–∞ —Ä–∞–∑–º–µ—Ä—ã –¥–æ–µ–∑–∂–∞—é—Ç —á—É—Ç—å –ø–æ–∑–∂–µ)
    setTimeout(place, 250);
    setTimeout(place, 900);
  })();
  <\/script>
</div>`;
  }

  function renderPreview(){
    ui.preview.innerHTML = buildWidgetCode(cfg());
  }

  function onAnyChange(){
    ui.sizeVal.textContent = ui.size.value;
    renderPreview();
  }

  // live update
  ui.size.addEventListener('input', onAnyChange);
  ui.rounds.addEventListener('input', onAnyChange);
  ui.pad.addEventListener('input', onAnyChange);
  ui.gap.addEventListener('input', onAnyChange);
  ui.anim.addEventListener('change', onAnyChange);
  ui.dur.addEventListener('input', onAnyChange);
  ui.task.addEventListener('input', onAnyChange);
  ui.endText.addEventListener('input', onAnyChange);
  ui.imgUrl.addEventListener('input', onAnyChange);

  ui.btnCode.addEventListener('click', ()=>{
    ui.out.value = buildWidgetCode(cfg());
    ui.out.focus();
    ui.out.select();
  });

  ui.btnCopy.addEventListener('click', async ()=>{
    if(!ui.out.value.trim()) ui.out.value = buildWidgetCode(cfg());
    try{
      await navigator.clipboard.writeText(ui.out.value);
      toast('–°–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–æ ‚úÖ');
    }catch(e){
      ui.out.focus(); ui.out.select();
      document.execCommand('copy');
      toast('–°–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–æ ‚úÖ');
    }
  });

  ui.btnReset.addEventListener('click', ()=>{
    ui.imgUrl.value = '';
    ui.size.value = 46; ui.sizeVal.textContent='46';
    ui.rounds.value = 7;
    ui.pad.value = 12;
    ui.gap.value = 200;
    ui.anim.value = 'softfade';
    ui.dur.value = 1100;
    ui.task.value = '–ù–∞–π–¥–∏ –±–∞–±–æ—á–∫—É –∏ –Ω–∞–∂–º–∏ –Ω–∞ –Ω–µ—ë!';
    ui.endText.value = '–ú–æ–ª–æ–¥–µ—Ü! –ü—Ä–∏—Ö–æ–¥–∏ –∏–≥—Ä–∞—Ç—å –µ—â—ë —Ä–∞–∑ üòä';
    ui.out.value = '';
    renderPreview();
  });

  // init
  ui.sizeVal.textContent = ui.size.value;
  renderPreview();
})();
</script>

</body>
</html>
