<!doctype html>
<html lang="ru">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,height=device-height,initial-scale=1.0">
<title>–†–µ–¥–∞–∫—Ç–æ—Ä ¬´–ù–∞–π–¥–∏ –ø–µ—Ä—Å–æ–Ω–∞–∂–∞¬ª</title>

<style>
html,body{
  margin:0;
  height:100%;
  background:#0b1020;
  font-family:system-ui,-apple-system,Segoe UI,Roboto;
  color:#fff;
}

.app{
  position:fixed;
  inset:0;
  display:grid;
  grid-template-columns:360px 1fr;
  gap:14px;
  padding:14px;
  box-sizing:border-box;
}

.panel{
  background:rgba(20,24,40,.75);
  backdrop-filter:blur(8px);
  border-radius:16px;
  padding:14px;
  overflow:auto;
}

.stage{
  position:relative;
  border-radius:16px;
  overflow:hidden;
  background:
    repeating-linear-gradient(
      135deg,
      rgba(255,255,255,.05) 0,
      rgba(255,255,255,.05) 8px,
      rgba(255,255,255,.02) 8px,
      rgba(255,255,255,.02) 16px
    );
}

h1{font-size:18px;margin:0 0 10px}
label{font-size:12px;opacity:.8}
input,select,textarea{
  width:100%;
  box-sizing:border-box;
  margin:4px 0 10px;
  padding:6px 8px;
  border-radius:8px;
  border:none;
  background:#11162b;
  color:#fff;
}
textarea{resize:vertical}

button{
  padding:8px 10px;
  border-radius:10px;
  border:none;
  cursor:pointer;
}
.blue{background:#2d6cff;color:#fff}
.green{background:#22c55e;color:#000}

.topText{
  position:absolute;
  top:16px;
  left:50%;
  transform:translateX(-50%);
  background:rgba(0,0,0,.55);
  padding:8px 14px;
  border-radius:999px;
  font-size:14px;
  pointer-events:none;
}

.counter{
  position:absolute;
  top:16px;
  right:16px;
  background:rgba(0,0,0,.5);
  padding:6px 10px;
  border-radius:999px;
  font-size:13px;
}

.hintBtn{
  position:absolute;
  top:60px;
  right:16px;
  width:38px;
  height:38px;
  border-radius:50%;
  background:rgba(255,255,255,.15);
  display:flex;
  align-items:center;
  justify-content:center;
  cursor:pointer;
}

.sprite{
  position:absolute;
  cursor:pointer;
  user-select:none;
}
</style>
</head>

<body>
<div class="app">

<div class="panel">
<h1>–†–µ–¥–∞–∫—Ç–æ—Ä ¬´–ù–∞–π–¥–∏ –ø–µ—Ä—Å–æ–Ω–∞–∂–∞¬ª</h1>

<label>URL –∫–∞—Ä—Ç–∏–Ω–∫–∏ –ø–µ—Ä—Å–æ–Ω–∞–∂–∞</label>
<input id="imgUrl" placeholder="–µ—Å–ª–∏ –ø—É—Å—Ç–æ ‚Äî babushka_2">

<label>–†–∞–∑–º–µ—Ä (px)</label>
<input type="range" min="24" max="160" value="46" id="size">

<label>–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –Ω–∞—Ö–æ–¥–æ–∫</label>
<input type="number" min="1" max="20" value="7" id="rounds">

<label>–ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è</label>
<input id="task" value="–ù–∞–π–¥–∏ –±–∞–±–æ—á–∫—É –∏ –Ω–∞–∂–º–∏ –Ω–∞ –Ω–µ—ë!">

<label>–¢–µ–∫—Å—Ç –≤ –∫–æ–Ω—Ü–µ</label>
<textarea id="endText">–ú–æ–ª–æ–¥–µ—Ü! –ü—Ä–∏—Ö–æ–¥–∏ –∏–≥—Ä–∞—Ç—å –µ—â—ë —Ä–∞–∑ üòä</textarea>

<button class="blue" onclick="start()">–ü—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä</button>
</div>

<div class="stage" id="stage">
  <div class="topText" id="topText"></div>
  <div class="counter" id="counter"></div>
  <div class="hintBtn" onclick="hint()">üí°</div>
</div>

</div>

<script>
const stage=document.getElementById('stage');
const topText=document.getElementById('topText');
const counter=document.getElementById('counter');

let sprite=null,found=0,total=7,size=46;

function loadImg(){
  const url=document.getElementById('imgUrl').value.trim();
  return url || './babushka_2';
}

function forbiddenRects(){
  const r=[];
  const w=stage.clientWidth,h=stage.clientHeight;

  // –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è
  r.push({x:w/2-160,y:0,w:320,h:90});
  // –ª–æ–≥–æ—Ç–∏–ø genially
  r.push({x:0,y:h-120,w:160,h:120});
  // —Å—Ç—Ä–µ–ª–∫–∏
  r.push({x:0,y:h/2-110,w:120,h:220});
  r.push({x:w-120,y:h/2-110,w:120,h:220});

  return r;
}

function intersects(x,y,s,fr){
  return !(x+s<fr.x||x>fr.x+fr.w||y+s<fr.y||y>fr.y+fr.h);
}

function randomPos(){
  const w=stage.clientWidth,h=stage.clientHeight;
  const fr=forbiddenRects();
  for(let i=0;i<200;i++){
    const x=Math.random()*(w-size);
    const y=Math.random()*(h-size);
    if(!fr.some(f=>intersects(x,y,size,f))){
      return {x,y};
    }
  }
  return {x:50,y:120};
}

function place(){
  const p=randomPos();
  sprite.style.left=p.x+'px';
  sprite.style.top=p.y+'px';
}

function start(){
  stage.innerHTML='';
  stage.appendChild(topText);
  stage.appendChild(counter);
  stage.appendChild(document.querySelector('.hintBtn'));

  found=0;
  total=+document.getElementById('rounds').value;
  size=+document.getElementById('size').value;

  topText.textContent=document.getElementById('task').value;
  counter.textContent=`0/${total}`;

  sprite=document.createElement('img');
  sprite.src=loadImg();
  sprite.className='sprite';
  sprite.style.width=size+'px';
  sprite.onclick=()=>{
    found++;
    counter.textContent=`${found}/${total}`;
    if(found>=total){
      topText.textContent=document.getElementById('endText').value;
      sprite.remove();
    }else{
      place();
    }
  };
  stage.appendChild(sprite);
  place();
}

function hint(){
  if(sprite){
    sprite.animate(
      [{opacity:1},{opacity:.2},{opacity:1}],
      {duration:600,iterations:2}
    );
  }
}
</script>
</body>
</html>
